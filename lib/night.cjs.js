"use strict";var t,s=(t=require("suncalc2"))&&"object"==typeof t&&"default"in t?t.default:t,e={auto:!0,brightness:!1,brightnessHighClass:"high-brightness",brightnessLowClass:"low-brightness",checkBreakpoint:!0,darkClass:"dark",lightClass:"",mode:"smart",permissionDelay:0,soundTimeout:1e3,soundUrl:"",storage:!0,storageClear:!0,sunriseTime:null,sunsetTime:null},i=function(){function t(t){var s=this;void 0===t&&(t={}),this.isPlaying=!1,this.autoCoords=!0,this.autoTimes=!0,this.today=new Date,this.isNight=function(){var t=new Date;return t.getTime()>s.times.sunrise&&t.getTime()<s.times.sunset},this.changeClasses=function(t,e){s.elements instanceof HTMLCollection?Object.values(s.elements).map((function(s){s.classList[t](e)})):s.elements instanceof HTMLElement&&s.elements.classList[t](e)},this.accessSuccess=function(t){var e=t.coords;s.coords={latitude:e.latitude,longitude:e.longitude},"function"==typeof s.callbacks.onAccess&&s.callbacks.onAccess(),s.settings.storage&&localStorage.setItem("location",JSON.stringify(s.coords))},this.accessError=function(t){"function"==typeof s.callbacks.onAccessDenied&&s.callbacks.onAccessDenied(),document.dispatchEvent(new CustomEvent("smartDarkError",{detail:t}))},this.elements=t.elements||document.body,this.settings=this.extendSettings(t.settings||{}),this.callbacks=t.callbacks||{},this.isInit=this.settings.auto,this.init()}return t.prototype.init=function(){"color-scheme"===this.settings.mode?(this.prefersColorScheme(),this.isInit=!1):"smart"===this.settings.mode&&(this.time(new Date),this.smartSwitch(this.isInit)),this.switchOnChange(),"function"==typeof this.callbacks.onInit&&this.callbacks.onInit(),this.settings.brightness&&this.ambientLight()},t.prototype.ambientLight=function(){var t=this;"ondevicelight"in window?(window.addEventListener("devicelight",(function(s){s.value<50?(t.changeClasses("add",t.settings.brightnessLowClass),t.changeClasses("remove",t.settings.brightnessHighClass)):(t.changeClasses("add",t.settings.brightnessHighClass),t.changeClasses("remove",t.settings.brightnessLowClass))})),"function"==typeof this.callbacks.onBrightness&&this.callbacks.onBrightness()):"function"==typeof this.callbacks.onBrightnessNotSupported&&(this.callbacks.onBrightnessNotSupported(),this.isNight()?(this.changeClasses("add",this.settings.brightnessLowClass),this.changeClasses("remove",this.settings.brightnessHighClass)):(this.changeClasses("add",this.settings.brightnessHighClass),this.changeClasses("remove",this.settings.brightnessLowClass)))},t.prototype.sound=function(){var t=this;if(!this.isPlaying){var s=new Audio(this.settings.soundUrl);this.isPlaying=!0,s.play(),"function"==typeof this.callbacks.onSoundPlay&&this.callbacks.onSoundPlay(),setTimeout((function(){s.pause(),s.currentTime=0,t.isPlaying=!1,"function"==typeof t.callbacks.onSoundPause&&t.callbacks.onSoundPause()}),this.settings.soundTimeout)}},t.prototype.light=function(){"function"==typeof this.callbacks.onLight&&this.callbacks.onLight(),this.isDark=!1,this.settings.lightClass&&this.changeClasses("add",this.settings.lightClass),this.changeClasses("remove",this.settings.darkClass),localStorage.setItem("dark","false")},t.prototype.dark=function(){"function"==typeof this.callbacks.onDark&&this.callbacks.onDark(),this.isDark=!0,this.settings.lightClass&&this.changeClasses("remove",this.settings.lightClass),this.changeClasses("add",this.settings.darkClass),localStorage.setItem("dark","true")},t.prototype.prefersColorScheme=function(){this.matchDark=window.matchMedia("(prefers-color-scheme: dark)").matches,this.matchLight=window.matchMedia("(prefers-color-scheme: light)").matches,this.matchDark||this.matchLight?(this.matchDark?this.dark():this.matchLight&&this.light(),this.isInit&&"function"==typeof this.callbacks.onColorScheme&&this.callbacks.onColorScheme()):this.isInit&&"function"==typeof this.callbacks.onColorSchemeNotSupported&&this.callbacks.onColorSchemeNotSupported()},t.prototype.smartSwitch=function(t){(t&&!localStorage.auto||!t)&&(localStorage.setItem("auto","true"),"function"==typeof this.callbacks.onSmartSwitch&&this.callbacks.onSmartSwitch()),this.settings.sunriseTime&&this.settings.sunsetTime?this.timeBreakpoints():"geolocation"in navigator&&this.isInit&&this.myLocation(),t&&(this.isInit=!1),this.theme(this.isDark)},t.prototype.time=function(t){var s=(new Date).setHours(24,0,0,0);localStorage.time?localStorage.location&&t.getTime()>JSON.parse(localStorage.time)&&(localStorage.removeItem("time"),this.settings.storageClear&&(localStorage.removeItem("location"),"function"==typeof this.callbacks.onStorageClear&&this.callbacks.onStorageClear())):localStorage.setItem("time",JSON.stringify(s))},t.prototype.theme=function(t){t!==this.isDark&&(t?this.dark():this.light())},t.prototype.switchOnChange=function(){var t=this.times,s=t.sunrise,e=t.sunset,i=this.coords,o=i.latitude,n=i.longitude,a={};localStorage.auto&&JSON.parse(localStorage.auto)&&JSON.stringify(a)!==JSON.stringify(this.times)&&(this.isNight()?this.light():this.dark(),a=this.times),document.dispatchEvent(new CustomEvent("smartDark",{detail:{sunrise:new Date(s),sunset:new Date(e),latitude:o,longitude:n}}))},t.prototype.myLocation=function(){var t=this;localStorage.location||!this.autoCoords?(this.autoCoords&&(this.coords=JSON.parse(localStorage.location)),this.autoTimes&&this.sunPosition()):setTimeout((function(){navigator.geolocation.getCurrentPosition(t.accessSuccess,t.accessError)}),this.settings.permissionDelay)},t.prototype.sunPosition=function(){var t,e,i=this.coords,o=i.latitude,n=i.longitude,a=s.getTimes(this.today,o,n);t=this.settings.sunriseTime?this.settings.sunriseTime.getTime():a.sunriseEnd-(a.sunriseEnd-a.sunrise)/2,e=this.settings.sunsetTime?this.settings.sunsetTime.getTime():a.sunset-(a.sunset-a.sunsetStart)/2,this.times={sunrise:t,sunset:e}},t.prototype.timeBreakpoints=function(){this.times={sunrise:this.settings.sunriseTime.getTime(),sunset:this.settings.sunsetTime.getTime()}},t.prototype.setCoords=function(t,s){this.coords={latitude:t,longitude:s},this.autoCoords=!1},t.prototype.setTimes=function(t,s){this.times={sunrise:t,sunset:s},this.autoTimes=!1},t.prototype.toggle=function(){"function"==typeof this.callbacks.onToggle&&this.callbacks.onToggle(),this.settings.soundUrl&&this.sound(),this.theme(!this.isDark),localStorage.setItem("auto","false")},t.prototype.reset=function(){localStorage.clear(),"function"==typeof this.callbacks.onReset&&this.callbacks.onReset()},t.prototype.destroy=function(){"function"==typeof this.callbacks.onDestroy&&this.callbacks.onDestroy()},t.prototype.extendSettings=function(t){var s,i={};for(s in e)i[s]=s in t?t[s]:e[s];return i},t}();module.exports=i;
//# sourceMappingURL=night.cjs.js.map
